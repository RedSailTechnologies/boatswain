name: ${{ .Parameters.name }}
version: ${{ .Parameters.version }}
clusters:
  - test
apps:
  - name: grafana
    helm:
      chart: grafana
      repo: bitnami
      version: '4.2.5'
triggers:
  - web:
      name: grafana-trigger
  - manual:
      name: user-trigger
      users:
        - "Adam Page"
strategy:
  - name: approve-install
    condition: any
    approval:
      users: 
        - 'Adam Page'
  - name: approve-install-admin
    condition: any
    approval:
      roles:
        - Admin
  - name: deploy-grafana
    condition: always
    app:
      name: grafana
      cluster: test
      namespace: default
      helm:
        command: install
        wait: true
        values:
          library:
            chart: grafana
            repo: bitnami
            version: '4.2.5'
            file: values-production.yaml
          raw:
            ingress:
              enabled: true
              hostName: localhost
              path: "/"
  - name: upgrade-grafana
    hold: 2m10s
    condition: succeeded
    app:
      name: grafana
      cluster: test
      namespace: default
      helm:
        command: upgrade
        wait: true
  - name: rollback-grafana
    hold: 1m
    condition: succeeded
    app:
      name: grafana
      cluster: test
      namespace: default
      helm:
        command: rollback
        wait: true
  - name: uninstall-grafana
    condition: succeeded
    app:
      name: grafana
      cluster: test
      namespace: default
      helm:
        command: uninstall
        wait: true
  - name: trigger-another-deployment
    condition: succeeded
    trigger:
      name: simple-deploy-trigger
      deployment: simple
      arguments:
        version: ${{ .Parameters.version }}
        
